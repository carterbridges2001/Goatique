<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Settings - Ruminary</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">GOATIQUE</a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="browse.html">Browse Goats</a>
                <a href="about.html">About</a>
                <a href="contact.html">Contact</a>
            </div>
            <div class="nav-actions">
                <a href="account.html" class="btn btn-outline-primary">My Account</a>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="row">
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-body text-center">
                        <div class="profile-avatar-container mx-auto mb-3">
                            <div class="avatar-initials" id="settingsAvatar">
                                <!-- Initials will be set by JavaScript -->
                            </div>
                        </div>
                        <h5 id="settingsName">Loading...</h5>
                        <p class="text-muted mb-0" id="settingsEmail">Loading...</p>
                        <button class="btn btn-sm btn-outline-primary mt-3" id="changeAvatarBtn">
                            <i class="fas fa-camera me-1"></i> Change Photo
                        </button>
                        <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                    </div>
                </div>
                
                <div class="list-group">
                    <a href="#profile" class="list-group-item list-group-item-action active" data-bs-toggle="tab">
                        <i class="fas fa-user me-2"></i> Profile
                    </a>
                    <a href="#security" class="list-group-item list-group-item-action" data-bs-toggle="tab">
                        <i class="fas fa-shield-alt me-2"></i> Security
                    </a>
                    <a href="#notifications" class="list-group-item list-group-item-action" data-bs-toggle="tab">
                        <i class="fas fa-bell me-2"></i> Notifications
                    </a>
                    <a href="#privacy" class="list-group-item list-group-item-action" data-bs-toggle="tab">
                        <i class="fas fa-lock me-2"></i> Privacy
                    </a>
                </div>
                
                <div class="mt-4
                <div class="card">
                    <div class="card-body">
                        <h6 class="card-title">Account Status</h6>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Email Verified</span>
                            <span class="badge bg-success">Verified</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span>Member Since</span>
                            <span id="memberSince" class="text-muted">2023</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="tab-content">
                    <!-- Profile Tab -->
                    <div class="tab-pane fade show active" id="profile">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Profile Information</h5>
                            </div>
                            <div class="card-body">
                                <form id="profileForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">First Name</label>
                                            <input type="text" class="form-control" id="firstName" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Last Name</label>
                                            <input type="text" class="form-control" id="lastName" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" id="email" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="phone" placeholder="+1 (___) ___-____">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Bio</label>
                                        <textarea class="form-control" id="bio" rows="3" placeholder="Tell us about yourself..."></textarea>
                                    </div>
                                    <div class="text-end">
                                        <button type="submit" class="btn btn-primary">Save Changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Security Tab -->
                    <div class="tab-pane fade" id="security">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Security Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-4">
                                    <h6>Change Password</h6>
                                    <form id="passwordForm" class="mb-4">
                                        <div class="mb-3">
                                            <label class="form-label">Current Password</label>
                                            <input type="password" class="form-control" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">New Password</label>
                                            <input type="password" class="form-control" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Confirm New Password</label>
                                            <input type="password" class="form-control" required>
                                        </div>
                                        <div class="text-end">
                                            <button type="submit" class="btn btn-primary">Update Password</button>
                                        </div>
                                    </form>
                                </div>
                                
                                <div class="mb-4">
                                    <h6>Two-Factor Authentication</h6>
                                    <p>Add an extra layer of security to your account by enabling two-factor authentication.</p>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="twoFactorSwitch">
                                        <label class="form-check-label" for="twoFactorSwitch">Enable Two-Factor Authentication</label>
                                    </div>
                                </div>
                                
                                <div class="border-top pt-3">
                                    <h6>Danger Zone</h6>
                                    <p class="text-muted">Once you delete your account, there is no going back. Please be certain.</p>
                                    <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                                        <i class="fas fa-trash-alt me-2"></i>Delete Account
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notifications Tab -->
                    <div class="tab-pane fade" id="notifications">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Notification Preferences</h5>
                            </div>
                            <div class="card-body">
                                <form id="notificationsForm">
                                    <h6 class="mb-3">Email Notifications</h6>
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="emailPromotions" checked>
                                            <label class="form-check-label" for="emailPromotions">Promotional Emails</label>
                                        </div>
                                        <small class="text-muted">Receive updates about new goats, promotions, and special offers.</small>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="emailUpdates" checked>
                                            <label class="form-check-label" for="emailUpdates">Account Updates</label>
                                        </div>
                                        <small class="text-muted">Receive important notifications about your account activity.</small>
                                    </div>
                                    
                                    <h6 class="mb-3 mt-4">Push Notifications</h6>
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="pushMessages" checked>
                                            <label class="form-check-label" for="pushMessages">Messages</label>
                                        </div>
                                        <small class="text-muted">Get notified about new messages from other users.</small>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="pushListings" checked>
                                            <label class="form-check-label" for="pushListings">Listing Updates</label>
                                        </div>
                                        <small class="text-muted">Get notified about updates to your listings and sales.</small>
                                    </div>
                                    
                                    <div class="text-end mt-4">
                                        <button type="submit" class="btn btn-primary">Save Preferences</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Privacy Tab -->
                    <div class="tab-pane fade" id="privacy">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Privacy Settings</h5>
                            </div>
                            <div class="card-body">
                                <form id="privacyForm">
                                    <div class="mb-4">
                                        <h6>Profile Visibility</h6>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="profileVisibility" id="visibilityPublic" checked>
                                            <label class="form-check-label" for="visibilityPublic">
                                                Public - Anyone can see your profile
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="radio" name="profileVisibility" id="visibilityPrivate">
                                            <label class="form-check-label" for="visibilityPrivate">
                                                Private - Only you can see your profile
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h6>Data Sharing</h6>
                                        <div class="form-check form-switch mb-2">
                                            <input class="form-check-input" type="checkbox" id="shareAnalytics" checked>
                                            <label class="form-check-label" for="shareAnalytics">
                                                Share anonymous usage data to help improve our services
                                            </label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="personalizedAds" checked>
                                            <label class="form-check-label" for="personalizedAds">
                                                Show personalized ads based on my activity
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h6>Data Management</h6>
                                        <p class="text-muted">Download or delete your personal data.</p>
                                        <button type="button" class="btn btn-outline-primary me-2">
                                            <i class="fas fa-download me-2"></i>Download My Data
                                        </button>
                                        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteDataModal">
                                            <i class="fas fa-trash-alt me-2"></i>Delete My Data
                                        </button>
                                    </div>
                                    
                                    <div class="text-end">
                                        <button type="submit" class="btn btn-primary">Save Privacy Settings</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Account Modal -->
    <div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete Your Account</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete your account? This action cannot be undone. All your data will be permanently removed.</p>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="confirmDelete">
                        <label class="form-check-label" for="confirmDelete">
                            I understand that this action is irreversible
                        </label>
                    </div>
                    <div class="alert alert-warning" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        This will permanently delete your account and all associated data.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn" disabled>Delete My Account</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Data Modal -->
    <div class="modal fade" id="deleteDataModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Delete Your Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>This will delete all your personal data from our systems. Your account will remain active, but all your personal information will be removed.</p>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="confirmDataDelete">
                        <label class="form-check-label" for="confirmDataDelete">
                            I understand that this action is irreversible
                        </label>
                    </div>
                    <div class="alert alert-warning" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        This will permanently delete all your personal data from our systems.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDataDeleteBtn" disabled>Delete My Data</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Ruminary</h4>
                    <p>Your premier destination for high-quality goats and livestock.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Us</h4>
                    <p>Email: support@goatique.com</p>
                    <p>Phone: (555) 123-4567</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Ruminary. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const user = authUtils.getCurrentUser();
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            // Initialize user data
            function initUserData() {
                const displayName = user.displayName || 'User';
                const email = user.email || '';
                const initials = displayName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                
                document.getElementById('settingsName').textContent = displayName;
                document.getElementById('settingsEmail').textContent = email;
                document.getElementById('settingsAvatar').textContent = initials;
                
                // Set member since year
                const memberSince = user.metadata?.creationTime 
                    ? new Date(user.metadata.creationTime).getFullYear() 
                    : new Date().getFullYear();
                document.getElementById('memberSince').textContent = memberSince;
                
                // Set form values
                const nameParts = displayName.split(' ');
                document.getElementById('firstName').value = nameParts[0] || '';
                document.getElementById('lastName').value = nameParts.slice(1).join(' ') || '';
                document.getElementById('email').value = email;
            }
            
            // Initialize form submission handlers
            function initForms() {
                // Profile form
                document.getElementById('profileForm')?.addEventListener('submit', function(e) {
                    e.preventDefault();
                    // TODO: Update profile in Firebase
                    alert('Profile updated successfully!');
                });
                
                // Password form
                document.getElementById('passwordForm')?.addEventListener('submit', function(e) {
                    e.preventDefault();
                    // TODO: Update password in Firebase
                    alert('Password updated successfully!');
                    this.reset();
                });
                
                // Notifications form
                document.getElementById('notificationsForm')?.addEventListener('submit', function(e) {
                    e.preventDefault();
                    // TODO: Save notification preferences
                    alert('Notification preferences saved!');
                });
                
                // Privacy form
                document.getElementById('privacyForm')?.addEventListener('submit', function(e) {
                    e.preventDefault();
                    // TODO: Save privacy settings
                    alert('Privacy settings saved!');
                });
            }
            
            // Initialize modals
            function initModals() {
                // Delete account confirmation
                const confirmDelete = document.getElementById('confirmDelete');
                const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
                
                if (confirmDelete && confirmDeleteBtn) {
                    confirmDelete.addEventListener('change', function() {
                        confirmDeleteBtn.disabled = !this.checked;
                    });
                    
                    confirmDeleteBtn.addEventListener('click', function() {
                        // TODO: Delete account from Firebase
                        alert('Your account has been deleted. You will be redirected to the home page.');
                        authUtils.signOut()
                            .then(() => window.location.href = 'index.html')
                            .catch(error => console.error('Error signing out:', error));
                    });
                }
                
                // Delete data confirmation
                const confirmDataDelete = document.getElementById('confirmDataDelete');
                const confirmDataDeleteBtn = document.getElementById('confirmDataDeleteBtn');
                
                if (confirmDataDelete && confirmDataDeleteBtn) {
                    confirmDataDelete.addEventListener('change', function() {
                        confirmDataDeleteBtn.disabled = !this.checked;
                    });
                    
                    confirmDataDeleteBtn.addEventListener('click', function() {
                        // TODO: Delete user data from Firestore
                        alert('Your personal data has been deleted.');
                        const modal = bootstrap.Modal.getInstance(document.getElementById('deleteDataModal'));
                        modal.hide();
                    });
                }
                
                // Avatar upload
                const changeAvatarBtn = document.getElementById('changeAvatarBtn');
                const avatarUpload = document.getElementById('avatarUpload');
                
                if (changeAvatarBtn && avatarUpload) {
                    changeAvatarBtn.addEventListener('click', () => {
                        avatarUpload.click();
                    });
                    
                    avatarUpload.addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        // TODO: Upload avatar to Firebase Storage and update user profile
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            document.getElementById('settingsAvatar').style.backgroundImage = `url(${e.target.result})`;
                            document.getElementById('settingsAvatar').style.backgroundSize = 'cover';
                            document.getElementById('settingsAvatar').textContent = '';
                            alert('Profile picture updated successfully!');
                        };
                        reader.readAsDataURL(file);
                    });
                }
            }
            
            // Initialize everything
            initUserData();
            initForms();
            initModals();
            
            // Initialize tooltips
            if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            }
        });
    </script>
</body>
</html>
